using System;
using System.Collections.Generic;

public interface ЯУмеюВноситьИСнимать
{
    bool Внести(decimal сумма);
    bool Снять(decimal сумма);
}

public interface ЯУмеюПереводить
{
    bool Перевести(ЯУмеюВноситьИСнимать получатель, decimal сумма);
}

public class БанковскийСчет : ЯУмеюВноситьИСнимать, ЯУмеюПереводить
{
    public string Владелец { get; private set; }
    public decimal Баланс { get; private set; }

    public БанковскийСчет(string владелец, decimal начальныйБаланс = 0)
    {
        Владелец = владелец;
        Баланс = начальныйБаланс;
    }

    public bool Внести(decimal сумма)
    {
        if (сумма <= 0)
        {
            Console.WriteLine($"{Владелец}: Ошибка! Сумма для внесения должна быть больше 0.");
            return false;
        }

        Баланс += сумма;
        Console.WriteLine($"{Владелец}: Внесено сумма :C. Новый баланс: {Баланс:C}");
        return true;
    }

    public bool Снять(decimal сумма)
    {
        if (сумма <= 0)
        {
            Console.WriteLine($"{Владелец}: Ошибка! Сумма для снятия должна быть больше 0.");
            return false;
        }

        if (сумма > Баланс)
        {
            Console.WriteLine($"{Владелец}: Ошибка! Недостаточно средств на счете. Текущий баланс: {Баланс:C}");
            return false;
        }

        Баланс -= сумма;
        Console.WriteLine($"{Владелец}: Снято {сумма:C}. Новый баланс: {Баланс:C}");
        return true;
    }

    public bool Перевести(ЯУмеюВноситьИСнимать получатель, decimal сумма)
    {
        if (сумма <= 0)
        {
            Console.WriteLine($"{Владелец}: Ошибка перевода! Сумма должна быть больше 0.");
            return false;
        }

        if (сумма > Баланс)
        {
            Console.WriteLine($"{Владелец}: Ошибка перевода! Недостаточно средств. Текущий баланс: {Баланс:C}");
            return false;
        }

        if (получатель == null)
        {
            Console.WriteLine($"{Владелец}: Ошибка перевода! Получатель не указан.");
            return false;
        }

        bool снятиеУспешно = Снять(сумма);

        if (снятиеУспешно)
        {
            
            bool внесениеУспешно = получатель.Внести(сумма);

            if (внесениеУспешно)
            {
                Console.WriteLine($"{Владелец}: Перевод {сумма:C} выполнен успешно!");
                return true;
            }
            else
            {
               
                Внести(сумма);
                Console.WriteLine($"{Владелец}: Перевод отменен. Проблема со счетом получателя.");
                return false;
            }
        }

        return false;
    }
}

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("=== Банковская система: Переводы между счетами ===\n");

        БанковскийСчет счетИвана = new БанковскийСчет("Иван Петров", 10000);
        БанковскийСчет счетМарии = new БанковскийСчет("Мария Сидорова", 5000);

        Console.WriteLine("Начальные балансы счетов:");
        Console.WriteLine($"1. {счетИвана.Владелец}: {счетИвана.Баланс:C}");
        Console.WriteLine($"2. {счетМарии.Владелец}: {счетМарии.Баланс:C}");

        Console.WriteLine("\n=== Выполняем операции ===");
        Console.WriteLine("\nОперация 1: Иван вносит деньги");
        счетИвана.Внести(3000);
        Console.WriteLine("\nОперация 2: Иван переводит деньги Марии");
        счетИвана.Перевести(счетМарии, 4500);
        Console.WriteLine("\nОперация 3: Мария пытается снять больше, чем есть");
        счетМарии.Снять(10000);
        Console.WriteLine("\nОперация 4: Мария переводит деньги Ивану");
        счетМарии.Перевести(счетИвана, 2000);
        Console.WriteLine("\nОперация 5: Пытаемся выполнить некорректный перевод");
        счетИвана.Перевести(счетМарии, -500); 
        Console.WriteLine("\n=== Итоговые балансы счетов ===");
        Console.WriteLine($"1. {счетИвана.Владелец}: {счетИвана.Баланс:C}");
        Console.WriteLine($"2. {счетМарии.Владелец}: {счетМарии.Баланс:C}");
        Console.WriteLine("\n=== Возможности счетов ===");
        List<object> счета = new List<object> { счетИвана, счетМарии };

        foreach (var счет in счета)
        {
            if (счет is БанковскийСчет банковскийСчет)
            {
                Console.WriteLine($"\n{банковскийСчет.Владелец}:");
                Console.WriteLine($"  - Может вносить и снимать деньги: Да");
                Console.WriteLine($"  - Может переводить на другие счета: Да");
                Console.WriteLine($"  - Текущий баланс: {банковскийСчет.Баланс:C}");
            }
        }

        Console.WriteLine("\n=== Демонстрация завершена. Нажмите Enter для выхода ===");
        Console.ReadLine();  
    }
}
